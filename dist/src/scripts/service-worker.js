import{LocalStorage}from"./storage.js";import{Url}from"./url.js";import{firestore,add_data}from"./firebase.js";var userId,projectId,storage=new LocalStorage,userTimeline=[],trackUserInMillis=1e4,uploadDataInMillis=1e4,USER_TIMELINE="user_timeline",USER_OFF_SCREEN="user_off_screen";async function getCurrentTabUrl(){let e="";try{let t={active:!0,currentWindow:!0},[o]=await chrome.tabs.query(t);e=null==o?USER_OFF_SCREEN:o.url}catch(e){console.error(e)}return console.log("tracking tab",e),e}async function addTabToUserTimeline(){var e=[new Url(await getCurrentTabUrl()).host,Date.now()];userTimeline.push(e),storage.saveValue(USER_TIMELINE,userTimeline),console.log("Added tab and timestamp to localstorage"),showUserActivity()}async function getCurrentTab(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return console.log(e,e.url),e}async function addData(){console.log("Adding data"),storage.getValue(USER_TIMELINE,(function(e){console.log("uploadingData",e),chrome.identity.getProfileUserInfo((t=>{userId=t,console.log(e),console.log(t),add_data("user_id8Feb",e)}))})),console.log("data added")}function trackCurrentActivity(){setInterval(addTabToUserTimeline,trackUserInMillis)}function showUserActivity(){storage.getValue(USER_TIMELINE,(function(e){console.log("value in USER_TIMELINE",e)})),getMemoryUsed()}function getMemoryUsed(){storage.getMemoryUse(USER_TIMELINE,(function(e){console.log((e/1024).toFixed(2)+"Kb")}))}function uploadData(){setInterval(addData,uploadDataInMillis)}console.log("firestore collection is fetched ",firestore),trackCurrentActivity(),uploadData();